@using WebAppForMVC.Models.ViewModels;
@using WebAppForMVC.Enums;
@model StudentViewModel;

@{
    ViewData["Title"] = "Student Page";

    var students = @Model.Students.Select(s => new
    {
        s.Id,
        s.SchoolId,
        Name = string.Join(" ", s.FirstName, s.LastName),
        YearLevelAndSection = string.Concat(s.YearLevel, s.Section),
        s.Program,
        s.Department
    });
}

<div>
    <h1 class="text-center">STUDENT PAGE</h1>
    <hr>
</div>

<div class="d-flex">
    <div class="mb-4 me-3 card w-25">
        <div class="card-header">
            <h3>Options</h3>
        </div>
        <div class="card-body">
            <form class="form" asp-action="Index" method="post">
                <div class="mb-2">
                    <div>
                        <label class="form-label" asp-for="SortParameter">Sort By</label>
                        <select asp-for="SortParameter" class="form-select">
                            <option value="SchoolId">School Id</option>
                            <option value="Name">Name</option>
                            <option value="YearAndSection">Year and Section</option>
                            <option value="Program">Program</option>
                            <option value="Department">Department</option>                        
                        </select>
                        <div class="mx-auto mt-1">
                            <div class="form-check form-switch">
                                <label class="form-label me-2" asp-for="IsDescending">Descending</label>
                                <input class="form-check-input" type="checkbox" role="switch" asp-for="IsDescending">
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="form-label" asp-for="SearchParameter">Search</label>
                    <div class="d-flex mb-2">
                        <input type="text" asp-for="SearchParameter" class="form-control me-1"
                            value="@Model.SearchParameter" placeholder="Search students...">
                    </div>
                </div>
                <div class="mb-2">
                    <label asp-for="YearLevelFilter" class="form-label"></label>
                    <div class="d-flex">
                        <div class="form-check flex-grow-1">
                            <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="1"
                                id="yearLevelFilter1" data-checked="false">
                            <label class="form-check-label" for="yearLevelFilter1">1</label>
                        </div>
                        <div class="form-check flex-grow-1">
                            <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="2"
                                id="yearLevelFilter2" data-checked="false">
                            <label class="form-check-label" for="yearLevelFilter2">2</label>
                        </div>
                        <div class="form-check flex-grow-1">
                            <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="3"
                                id="yearLevelFilter3" data-checked="false">
                            <label class="form-check-label" for="yearLevelFilter3">3</label>
                        </div>
                        <div class="form-check flex-grow-1">
                            <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="4"
                                id="yearLevelFilter4">
                            <label class="form-check-label" for="yearLevelFilter4">4</label>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="SectionFilter"></label>
                    <select asp-for="SectionFilter" asp-items="@Model.GetSelectListSections()" class="form-select">
                          <option selected>None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="ProgramFilter"></label>
                    <select asp-for="ProgramFilter" asp-items="@Model.GetSelectListPrograms()" class="form-select">
                          <option selected value="">None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="DepartmentFilter"></label>
                    <select asp-for="DepartmentFilter" asp-items="@Model.GetSelectListDepartments()" class="form-select">
                          <option selected value="">None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.AgeMinimumFilter"></label>
                    <input class="form-control" asp-for="@Model.AgeMinimumFilter">
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.AgeMaximumFilter"></label>
                    <input class="form-control" asp-for="@Model.AgeMaximumFilter">
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.MunicipalityFilter"></label>
                    <input class="form-control" asp-for="@Model.MunicipalityFilter" list="municipalities">
                    <datalist id="municipalities">
                        <option value="Alaminos"></option>
                        <option value="Dolores"></option>
                        <option value="Nagcarlan"></option>
                        <option value="San Pablo"></option>
                        <option value="Tiaong"></option>                        
                    </datalist>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.ProvinceFilter"></label>
                    <input class="form-control" asp-for="@Model.ProvinceFilter" list="provinces">
                    <datalist id="provinces">
                        <option value="Batangas"></option>
                        <option value="Laguna"></option>
                        <option value="Quezon"></option>
                    </datalist>
                </div>
                <div class="mb-2">
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@SexType.MALE" asp-for="@Model.SexFilter"
                                    id="sexTypeMale" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="sexTypeMale">Male</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@SexType.FEMALE" asp-for="@Model.SexFilter"
                                    id="sexTypeFemale" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="sexTypeFemale">Female</label>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@StudentType.REGULAR" asp-for="@Model.TypeFilter"
                                    id="studentTypeRegular" data-checked="false">
                            <label asp-for="@Model.TypeFilter" class="form-check-label" for="studentTypeRegular">Regular</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@StudentType.IRREGULAR" asp-for="@Model.TypeFilter"
                                    id="studentTypeIrregular" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="studentTypeIrregular">Irregular</label>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <input class="btn btn-primary w-100" type="submit">
                </div>
                <div>
                    <a class="btn btn-primary w-100" asp-action="Index">Reset</a>
                </div>
            </form>
        </div>
    </div>
    <div class="flex-grow-1">
        <table class="table table-bordered table-sm table-hover table-striped">
            <thead>
                <tr>
                    <th>Student Id</th>                    
                    <th>Name</th>
                    <th>Year and Section</th>
                    <th>Program</th>
                    <th>Department</th>
                </tr>
            </thead>
            <tbody>
                @if (students.Count() == 0 || students.Any() == false)
                {
                    <tr>
                        <td colspan="5" class="text-center">No student records</td>
                    </tr>
                }
                @foreach (var s in students)
                {
                    <tr onclick="GoToStudentView('@s.Id')">
                        <td>@s.SchoolId</td>
                        <td>@s.Name</td>
                        <td>@s.YearLevelAndSection</td>
                        <td>@s.Program.Code</td>
                        <td>@s.Department.Code</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


<script>
    function GoToStudentView(studentId) {
        window.location.href = '@Url.Action("ViewStudent", "Student")' + '?itemid=' + studentId;
    }

    document.querySelectorAll('.form-check-input').forEach(function (radio) {
        radio.addEventListener('click', function () {
            if (this.dataset.checked === 'true') {
                this.checked = false;
                this.dataset.checked = 'false';
            } else {
                document.querySelectorAll('.form-check-input').forEach(function (r) {
                    r.dataset.checked = 'false';
                });
                this.dataset.checked = 'true';
            }
        });
    });
</script>