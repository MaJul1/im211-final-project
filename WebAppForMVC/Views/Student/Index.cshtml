@using WebAppForMVC.Models.ViewModels;
@using WebAppForMVC.Enums;
@model StudentViewModel;

@{
    ViewData["Title"] = "Student Page";

    var students = @Model.Students.Select(s => new
    {
        s.Id,
        s.SchoolId,
        Name = string.Join(" ", s.FirstName, s.LastName),
        YearLevelAndSection = string.Concat(s.YearLevel, s.Section),
        s.Program,
        s.Department
    });
}

<div>
    <h1 class="text-center">STUDENT PAGE</h1>
    <hr>
</div>

<div class="d-flex">
    <div class="mb-4 me-3 card">
        <div class="card-header">
            <h3>Filter</h3>
        </div>
        <div class="card-body">
            <form class="form" asp-action="Index" method="post">
                <div class="d-flex mb-2">
                    <input type="text" asp-for="SearchParameter" class="form-control me-1"
                        value="@Model.SearchParameter" placeholder="Search students...">
                    <button type="submit" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="feather feather-search">
                            <circle cx="11" cy="11" r="8"></circle>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                        </svg>
                    </button>
                </div>
                <div class="mb-2">
                    <label asp-for="YearLevelFilter" class="form-label"></label>
                    <div class="row">
                        <div class="col">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="1"
                                    id="yearLevelFilter1" data-checked="false">
                                <label class="form-check-label" for="yearLevelFilter1">1</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="2"
                                    id="yearLevelFilter2" data-checked="false">
                                <label class="form-check-label" for="yearLevelFilter2">2</label>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="3"
                                    id="yearLevelFilter3" data-checked="false">
                                <label class="form-check-label" for="yearLevelFilter3">3</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" asp-for="YearLevelFilter" value="4"
                                    id="yearLevelFilter4">
                                <label class="form-check-label" for="yearLevelFilter4">4</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="SectionFilter"></label>
                    <select asp-for="SectionFilter" asp-items="@Model.SectionOptions" class="form-select">
                          <option selected>None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="ProgramFilter"></label>
                    <select asp-for="ProgramFilter" asp-items="@Model.ProgramOptions" class="form-select">
                          <option selected value="">None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="DepartmentFilter"></label>
                    <select asp-for="DepartmentFilter" asp-items="@Model.DepartmentOptions" class="form-select">
                          <option selected value="">None</option>
                    </select>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.AgeMinimumFilter"></label>
                    <input class="form-control" asp-for="@Model.AgeMinimumFilter">
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.AgeMaximumFilter"></label>
                    <input class="form-control" asp-for="@Model.AgeMaximumFilter">
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.MunicipalityFilter"></label>
                    <input class="form-control" asp-for="@Model.MunicipalityFilter" list="municipalities">
                    <datalist id="municipalities">
                        <option value="Alaminos"></option>
                        <option value="Dolores"></option>
                        <option value="Nagcarlan"></option>
                        <option value="San Pablo"></option>
                        <option value="Tiaong"></option>                        
                    </datalist>
                </div>
                <div class="mb-2">
                    <label class="form-label" asp-for="@Model.ProvinceFilter"></label>
                    <input class="form-control" asp-for="@Model.ProvinceFilter" list="provinces">
                    <datalist id="provinces">
                        <option value="Batangas"></option>
                        <option value="Laguna"></option>
                        <option value="Quezon"></option>
                    </datalist>
                </div>
                <div class="mb-2">
                    <label class="form-lable" asp-for="@Model.SexFilter"></label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@SexType.MALE" asp-for="@Model.SexFilter"
                                    id="sexTypeMale" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="sexTypeMale">Male</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@SexType.FEMALE" asp-for="@Model.SexFilter"
                                    id="sexTypeFemale" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="sexTypeFemale">Female</label>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <label class="form-lable" asp-for="@Model.TypeFilter"></label>
                    <div class="row">
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@StudentType.REGULAR" asp-for="@Model.TypeFilter"
                                    id="studentTypeRegular" data-checked="false">
                            <label asp-for="@Model.TypeFilter" class="form-check-label" for="studentTypeRegular">Regular</label>
                        </div>
                        <div class="col">
                            <input class="form-check-input" type="radio" value="@StudentType.IRREGULAR" asp-for="@Model.TypeFilter"
                                    id="studentTypeIrregular" data-checked="false">
                            <label asp-for="@Model.SexFilter" class="form-check-label" for="studentTypeIrregular">Irregular</label>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="flex-grow-1">
        <table class="table table-bordered table-sm table-hover table-striped">
            <thead>
                <tr>
                    <th><a asp-action="Index" asp-controller="Student"
                            asp-route-sortParam="@ViewData["IdSortParam"]">Student Id</a></th>
                    <th><a asp-action="Index" asp-controller="Student"
                            asp-route-sortParam="@ViewData["NameSortParam"]">Full
                            Name</a></th>
                    <th><a asp-action="Index" asp-controller="Student"
                            asp-route-sortParam="@ViewData["YearAndSectionSortParam"]">Year and Section</a></th>
                    <th><a asp-action="Index" asp-controller="Student"
                            asp-route-sortParam="@ViewData["ProgramSortParam"]">Program</a></th>
                    <th><a asp-action="Index" asp-controller="Student"
                            asp-route-sortParam="@ViewData["DepartmentSortParam"]">Department Id</a></th>
                </tr>
            </thead>
            <tbody>
                @if (students.Count() == 0 || students.Any() == false)
                {
                    <tr>
                        <td colspan="5" class="text-center">No student records</td>
                    </tr>
                }
                @foreach (var s in students)
                {
                    <tr onclick="GoToStudentView('@s.Id')">
                        <td>@s.SchoolId</td>
                        <td>@s.Name</td>
                        <td>@s.YearLevelAndSection</td>
                        <td>@s.Program</td>
                        <td>@s.Department</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

</div>


<script>
    function GoToStudentView(studentId) {
        window.location.href = '@Url.Action("ViewStudent", "Student")' + '?itemid=' + studentId;
    }

    document.querySelectorAll('.form-check-input').forEach(function (radio) {
        radio.addEventListener('click', function () {
            if (this.dataset.checked === 'true') {
                this.checked = false;
                this.dataset.checked = 'false';
            } else {
                document.querySelectorAll('.form-check-input').forEach(function (r) {
                    r.dataset.checked = 'false';
                });
                this.dataset.checked = 'true';
            }
        });
    });
</script>